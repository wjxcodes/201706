{#// 加载头部公共文件 #}
{#include file="Manage@Public/header" /#}
<!-- 主体内容  -->
<div class="content" >
<!-- 列表显示区域  -->
<div>
<!-- Think 系统列表组件开始 -->
<table id="checkList" class="list" cellpadding="5" cellspacing="0" border="1">
    <tr><td height="7" colspan="7" class="topTd" ></td></tr>
    <tr class="row" >
        <th width="10%">编号</th>
        <th>题文</th>
        <th>知识点</th>
        <th>章节</th>
        <th>专题</th>
        <th>难度</th>
        <th>操作</th>
    </tr>
    {#volist name="testInfo" id="node" item="key" #}
        <tr class="row" jl='' id="tr{#$key#}">
        <td>{#$key#}</td>
        <td>
            <span>
                <label>
                    <input type="radio" {#$node.test.Checked#}  name="evaluation[{#$node.WTID#}]['test']" value="1" class='correctAudit'/>审核正确
                </label>
                <label>
                    <input type="radio" name="evaluation[{#$node.WTID#}]['test']" {#$node.test.Checked2#}  value="2" class='incorrectAudit'/>审核错误
                </label><br>
                <textarea name="evaluation[{#$node.WTID#}]['test']['Suggestion']" class='incorrectText' style='width:150px; height:60px;{#if condition="$node['test']['Checked'] neq '' "#}display:none;{#/if#}'>{#$node.test.Suggestion#}</textarea>
            </span><br />{#eq name="node.test.IfRight" value="0"#}<font color="green">√</font>{#else/#}<font color="red">{#$node.test.Content#}</font>{#/eq#}
        </td>
        <td>
            <span>
                <label>
                    <input type="radio" {#$node.knowledge.Checked#}  name="evaluation[{#$node.WTID#}]['knowledge']" value="1"  class='correctAudit'/>审核正确
                </label>
                <label>
                    <input type="radio" name="evaluation[{#$node.WTID#}]['knowledge']" {#$node.knowledge.Checked2#}  value="2"  class='incorrectAudit'/>审核错误
                </label><br>
                <textarea name="evaluation[{#$node.WTID#}]['knowledge']['Suggestion']" class='incorrectText' style='width:150px; height:60px;{#if condition="$node['knowledge']['Checked'] neq '' "#}display:none;{#/if#}'>{#$node.knowledge.Suggestion#}</textarea>
            </span><br />{#eq name="node.knowledge.IfRight" value="0"#}<font color="green">√</font>{#else/#}<font color="red">{#$node.knowledge.Content#}</font>{#/eq#}
        </td>
        <td>
            <span>
                <label>
                    <input type="radio" {#$node.chapter.Checked#}  name="evaluation[{#$node.WTID#}]['chapter']" value="1"  class='correctAudit'/>审核正确
                </label>
                <label>
                    <input type="radio" name="evaluation[{#$node.WTID#}]['chapter']" {#$node.chapter.Checked2#} value="2"  class='incorrectAudit'/>审核错误
                </label><br>
                <textarea name="evaluation[{#$node.WTID#}]['chapter']['Suggestion']" class='incorrectText' style='width:150px; height:60px;{#if condition="$node['chapter']['Checked'] neq '' "#}display:none;{#/if#}'>{#$node.chapter.Suggestion#}</textarea>
            </span><br />{#eq name="node.chapter.IfRight" value="0"#}<font color="green">√</font>{#else/#}<font color="red">{#$node.chapter.Content#}</font>{#/eq#}
        </td>
        <td>
            <span>
                <label>
                    <input type="radio" {#$node.special.Checked#}  name="evaluation[{#$node.WTID#}]['special']" value="1"  class='correctAudit' />审核正确
                </label>
                <label>
                    <input type="radio" name="evaluation[{#$node.WTID#}]['special']" {#$node.special.Checked2#} value="2"  class='incorrectAudit'/>审核错误
                </label><br>
                <textarea name="evaluation[{#$node.WTID#}]['special']['Suggestion']" class='incorrectText' style='width:150px; height:60px;{#if condition="$node['special']['Checked'] neq ''"#}display:none;{#/if#}'>{#$node.special.Suggestion#}</textarea>
            </span><br />{#eq name="node.special.IfRight" value="0"#}<font color="green">√</font>{#else/#}<font color="red">{#$node.special.Content#}</font>{#/eq#}
        </td>
        <td>
            <span>
                <label>
                    <input type="radio" {#$node.diff.Checked#}  name="evaluation[{#$node.WTID#}]['diff']" value="1"  class='correctAudit'/>审核正确
                </label>
                <label>
                    <input type="radio" name="evaluation[{#$node.WTID#}]['diff']" {#$node.diff.Checked2#} value="2"  class='incorrectAudit'/>审核错误
                </label><br>
                <textarea name="evaluation[{#$node.WTID#}]['diff']['Suggestion']" class='incorrectText' style='width:150px; height:60px;{#if condition="$node['diff']['Checked'] neq '' "#}display:none;{#/if#}'>{#$node.diff.Suggestion#}</textarea>
            </span><br />{#eq name="node.diff.IfRight" value="0"#}<font color="green">√</font>{#else/#}<font color="red">{#$node.diff.Content#}</font>{#/eq#}
        </td>
        <td>
        [<a href="javascript:void(0);" class="showTest" thisid="{#$key#}" thiswid="{#$workID#}"><font color="red">编辑</font></a>]&nbsp;
        [<a href="javascript:void(0);" class="comment" thisid="{#$node.WTID#}"><font color="red">评价</font></a>]&nbsp;
        </td>
        </tr>
    {#/volist#}
    <tr><td height="7" colspan="7" class="bottomTd"></td></tr>
</table>
<!-- Think 系统列表组件结束 -->
</div>
<div>
</div>
<!-- 列表显示区域结束 -->
</div>
<link type="text/css" rel="stylesheet" href="__PUBLIC__/zjadmin/css/newedit.css{#$Think.config.WLN_UPDATE_FILE_DATE#}" />
<script src="__PUBLIC__/zjadmin/js/newEdit.js{#$Think.config.WLN_UPDATE_FILE_DATE#}"></script>

<!-- 主体内容结束 -->
<script>
var currentUrl=U('Test');
$(document).ready(function(){
     $(document).bind("selectstart",function(){return false;});
    $.newEdit.init();
    $('.correctAudit').each(function(){
        $(this).click(function(){
            $(this).parent().siblings('.incorrectText').hide().val('');
        }); 
    });
    $('.incorrectAudit').each(function(){
        $(this).click(function(){
            $(this).parent().siblings('.incorrectText').show();
        }); 
    });
    $(".comment").live('click',function(){
        var keyValue = $(this).attr('thisid');
        var test='';
        var testText='';
        var knowledge='';
        var knowledgeText='';
        var chapter='';
        var chapterText='';
        var special='';
        var specialText='';
        var diff='';
        var diffText='';
        var name='evaluation['+keyValue+']["test"]';
        if($('[name="evaluation['+keyValue+'][\'test\']"]').length>0){
            $('[name="evaluation['+keyValue+'][\'test\']"]').each(function(){
                if($(this).attr('checked')=='checked'){
                     test= $(this).val();
                }
            });
            testText = $('[name="evaluation['+keyValue+'][\'test\'][\'Suggestion\']"]').val();
        }
        if($('[name="evaluation['+keyValue+'][\'knowledge\']"]').length>0){
            $('[name="evaluation['+keyValue+'][\'knowledge\']"]').each(function(){
                if($(this).attr('checked')=='checked'){
                     knowledge= $(this).val();
                }
            });
            knowledgeText = $('[name="evaluation['+keyValue+'][\'knowledge\'][\'Suggestion\']"]').val();
        }
        if($('[name="evaluation['+keyValue+'][\'chapter\']"]').length>0){
            $('[name="evaluation['+keyValue+'][\'chapter\']"]').each(function(){
                if($(this).attr('checked')=='checked'){
                    chapter= $(this).val();
                }
            });
            chapterText = $('[name="evaluation['+keyValue+'][\'chapter\'][\'Suggestion\']"]').val();
        }
        if($('[name="evaluation['+keyValue+'][\'special\']"]').length>0){
            $('[name="evaluation['+keyValue+'][\'special\']"]').each(function(){
                if($(this).attr('checked')=='checked'){
                    special= $(this).val();
                }
            });
            specialText = $('[name="evaluation['+keyValue+'][\'special\'][\'Suggestion\']"]').val();
        }
        if($('[name="evaluation['+keyValue+'][\'diff\']"]').length>0){
            $('[name="evaluation['+keyValue+'][\'diff\']"]').each(function(){
                if($(this).attr('checked')=='checked'){
                     diff= $(this).val();
                }
            });
            diffText = $('[name="evaluation['+keyValue+'][\'diff\'][\'Suggestion\']"]').val();
        }
        var data = {
            "test":test,
            'testText':testText,
            "knowledge":knowledge,
            'knowledgeText':knowledgeText,
            "chapter":chapter,
            'chapterText':chapterText,
            "special":special,
            'specialText':specialText,
            "diff":diff,
            'diffText':diffText,
            "WTID":keyValue
        }
        $.post(U('Teacher/TaskB/saveCheckResult'),data,function(data){
            //权限验证
            if(checkPower(data)=='error'){
                return false;
            }
            alert(data['data']);
        });
    });
    $('.showTest').live('click',function(){
        jInfo('加载中请稍候。。。','加载数据');
        //获取数据
        var id=$(this).attr('thisid');
        var wid=$(this).attr('thiswid');
        $.get(U('Test/Test/edit?id='+id+'&workID='+wid),function(msg){
            jClose();
            //权限验证
            if(checkPower(msg)=='error'){
                return false;
            }
            var data=msg['data'];
                jFrame(data,'编辑试题：编号'+id);
        });
    });
    //修改框事件
    // $('.selectChapter').chapterSelectChange('__URL__');
    // $('.selectKnowledge').knowledgeSelectChange('__URL__');

    /*$('#subject').change(function(){
     $('#klinput').html('');
     if($(this).val()!=''){
     $.get(U("__URL__/getdata?s="+$(this).val()+"&l=p"),function(data){
     $('#special').html('<option value="">请选择</option>'+data);
     });
     $.get(U("__URL__/getdata?s="+$(this).val()+"&l=t"),function(data){
     $('#types').html('<option value="">请选择</option>'+data);
     });
     $.get(U("__URL__/getdata?s="+$(this).val()+"&l=k"),function(data){
     $('#knowledge').html('<option value="">请选择</option>'+data);
     });
     }else{
     $('#types').html('<option value="">请选择</option>');
     $('#knowledge').html('<option value="">请选择</option>');
     $('#special').html('<option value="">请选择</option>');
     }
     });*/
    // $('#addkl').live('click',function(){
    //     if($('.selectKnowledge').last().val().indexOf('t')==-1){
    //         alert('请选择正确的知识点');
    //         return false;
    //     }

    //     var kid=$('.selectKnowledge').last().val().replace('t','');
    //     var xx_s="";
    //     $('.selectKnowledge').each(function(){
    //         xx_s+=' >> '+$(this).find("option:selected").text();
    //     });
    //     console.log(input);
    //     var xx=input.replace('#value#',kid).replace('#str#',xx_s.replace(/┉/g,'').replace('┝',''));


    //     if($('#knowledgeList').html().indexOf('value="'+kid+'"')==-1 && $('#knowledgeList').html().indexOf('value='+kid+'')==-1){
    //         $('#knowledgeList').append(xx);
    //         $('.delhang').css({'padding':'0px 5px','cursor':'pointer','color':'#f00'});
    //     }
    // });
    // $('#addcp').live('click',function(){
    //     //if($('.selectChapter').last().val().indexOf('c')==-1){
    //     //    alert('请选择正确的数据');
    //     //    return false;
    //     //}
    //     if(!$('.selectChapter:eq(1)').val()){
    //         alert('请选择正确的数据');
    //         return false;
    //     }

    //     var cid=$('.selectChapter').last().val().replace('c','');
    //     var tmp_position=0;
    //     if(!cid){
    //         tmp_position=1;
    //         cid=$('.selectChapter').last().prev().val().replace('c','');
    //     }
    //     var xx_s="";
    //     $('.selectChapter').each(function(i){
    //         if(!(tmp_position==1 && $('.selectChapter').length==(i+1)))
    //             xx_s+=' >> '+$(this).find("option:selected").text();
    //     });
    //     var xx=inputcp.replace('#value#',cid).replace('#str#',xx_s.replace(/┉/g,'').replace('┝',''));

    //     if($('#chapterList').html().indexOf('value="'+cid+'"')==-1 && $('#chapterList').html().indexOf('value='+cid+'')==-1){
    //         $('#chapterList').append(xx);
    //         $('.delhang').css({'padding':'0px 5px','cursor':'pointer','color':'#f00'});
    //     }
    // });
    // //载入默认章节
    // $('#adddcp').live('click',function(){
    //     var result='';
    //     $('.kl').each(function(){
    //         result += $(this).val()+",";
    //     });
    //     var kl=result.substring(0, result.length-1);
    //     var testid=$('#TestID').val();
    //     $.get('__MODULE__-Test-getchapter-kl-'+kl+'-id-'+testid+'-'+Math.random(),function(msg){
    //         //权限验证
    //         if(checkPower(msg)=='error'){
    //             return false;
    //         }
    //         var data=msg['data'];
    //         if(data){
    //             var flag=0;
    //             for(var i=0;i<data.length;i++){
    //                 var xx=inputcp.replace('#value#',data[i]['ChapterID']).replace('#str#',data[i]['ChapterName']);
    //                 if($('#chapterList').html().indexOf('value="'+data[i]['ChapterID']+'"')==-1 && $('#chapterList').html().indexOf("value='"+data[i]['ChapterID']+"'")==-1 && $('#chapterList').html().indexOf('value='+data[i]['ChapterID']+' ')==-1){
    //                     $('#chapterList').append(xx);
    //                     flag=1;
    //                 }
    //             }
    //             $('.delhang').css({'padding':'0px 5px','cursor':'pointer','color':'#f00'});
    //             if(!flag){
    //                 alert('默认章节已经全部载入！');
    //             }
    //         }else{
    //             alert('暂无对应章节！');
    //         }
    //     },'json');
    // });
    // $('.delhang').live('click',function(){
    //     $(this).parent().remove();
    // });
    // $('.delhang').live('mouseover',function(){
    //     $(this).css({'background-color':'#f00','color':'#fff'});
    // });
    // $('.delhang').live('mouseout',function(){
    //     $(this).css({'background-color':'#fff','color':'#f00'});
    // });
    // $('.xt_title').live('click',function(){
    //     var idx = $(this).attr('id').replace('xt','');
    //     changext(idx);
    // });

    // //客观主观切换
    // $('#kg').live('click',function(){
    //     $('.zgdf').hide();
    //     $('.kgdf').show();
    //     changext(1);
    // });
    // $('#zg').live('click',function(){
    //     $('.kgdf').hide();
    //     $('.zgdf').show();
    // });

    // /*切换选项卡*/
    // function changext(idx){
    //     $('.xt_con').hide();
    //     $('.xt_con').addClass('none');
    //     $('.xt_con_'+idx).removeClass('none');
    //     $('.xt_con_'+idx).show();
    //     $('.xt_title').removeClass('xtcurrent');
    //     $('.xt_title').removeClass('xt');
    //     $('.xt_title').addClass('xt');
    //     $('#xt'+idx).addClass('xtcurrent');
    // }

    // $('#Diff').live('keydown',function(e){
    //     if(e.keyCode==13){
    //         $('#datasave').click(); //处理事件
    //     }
    // });
    // var y=0;
    // $('#getWidth').live('click',function(){
    //     y=1;
    //     var testid=$('#TestID').val();
    //     $.post("__MODULE__-Test-getOptionWidth",{'id':testid,'style':1,'m':Math.random()},function(msg){
    //         //权限验证
    //         if(checkPower(msg)=='error'){
    //             return false;
    //         }
    //         var data=msg['data'];
    //         if(data){
    //             var output=new Array();
    //             if(data.length==1){
    //                 output[0]='选项长度：'+data[0];
    //                 $('.optionwidth:eq(0) input').val(data[0][1]);
    //                 $('.optionnum:eq(0) input').val(data[0][0]);
    //             }else{
    //                 for(var i in data){
    //                     data[i][1]+'<br/>选项'+(parseInt(i)+1)+'数量：'+data[i][0];
    //                     $('.optionwidth:eq('+i+') input').val(data[i][1]);
    //                     $('.optionnum:eq('+i+') input').val(data[i][0]);
    //                 }
    //             }
    //             $('#widthCon').html(output.join('<br/>'));
    //         }else{
    //             alert('获取宽度失败！');
    //         }
    //         y=0;
    //     },'json');
    // });
    // var x=0;
    // var sdata=0;
    // $('#datasave').live('click',function(){
    //     if(x){
    //         alert('正在提交请稍候。。。');
    //         return false;
    //     }
    //     sdata=0;
    //     if($('#types').val()==''){
    //         alert('请选择题型');
    //         $('#types').focus();
    //         return false;
    //     }
    //     /*if($('#klinput').html()==''){
    //      alert('请添加知识点');
    //      $('#knowledge').focus();
    //      return false;
    //      }*/
    //     //主观客观打分
    //     if($('#kg').attr('checked')=='checked'){
    //         var fs=0;
    //         var tmp_arr=new Array();
    //         var xttimes=parseInt($(".mark").length)/parseInt($('#xttimes').val());
    //         $(".mark").each(function(i){
    //             if($(this).val()){
    //                 tmp_arr=$(this).val().split("|");
    //                 if(tmp_arr[1]>-1 && tmp_arr[1]<4) fs+=parseInt(tmp_arr[1]);
    //             }
    //             if((i+1)%xttimes==0 && i!=0){
    //                 if(fs<4 || fs>12){
    //                     alert('请选择正确的打分数据');
    //                     sdata=1;
    //                     return false;
    //                 }
    //                 fs=0;
    //             }
    //         });
    //     }else{
    //         var xsdiff=$('#Diff').val();
    //         if(xsdiff<0 || xsdiff>=1){
    //             alert('请填入正确的难度值');
    //             $('#Diff').focus();
    //             return false;
    //         }
    //     }

    //     if(sdata){
    //         return false;
    //     }
    //     x=1;
    //     if(x){
    //         var testid=$('#TestID').val();
    //         var typesid=$('#types').val();

    //         var kl='';
    //         if($('.kl').length>0){
    //             $('.kl').each(function(){
    //                 kl += $(this).val()+",";
    //             });
    //             kl=kl.substring(0, kl.length-1);
    //         }
    //         var cp='';
    //         if($('.cp').length>0){
    //             $('.cp').each(function(){
    //                 cp += $(this).val()+",";
    //             });
    //             cp=cp.substring(0, cp.length-1);
    //         }

    //         var specialid=$('#special').val();
    //         var docid=$('#DocID').val();

    //         var mark='';
    //         if($('.mark').length>0){
    //             $('.mark').each(function(){
    //                 mark += $(this).val()+",";
    //             });
    //             mark=mark.substring(0, mark.length-1);
    //         }

    //         var choose='';
    //         if($('.choose').length>0){
    //             $('.choose').each(function(){
    //                 if($(this).attr('checked')=='checked'){
    //                     choose = $(this).val();
    //                 }
    //             });
    //         }
    //         var chooselist='';
    //         var optionwidth='';
    //         var optionnum='';
    //         var choose_arr=new Array();
    //         var result;
    //         var optionwidtharr=new Array();
    //         var optionnumarr=new Array();
    //         //复合题
    //         if(choose==1){
    //             for(var ii=1;ii<50;ii++){
    //                 result=-1;
    //                 $('.choose'+ii).each(function(){
    //                     if($(this).attr('checked')=='checked'){
    //                         result = $(this).val();
    //                     }
    //                 });
    //                 if(result==-1) break;
    //                 optionwidtharr[ii-1]=$('.optionwidth'+ii).val();
    //                 optionnumarr[ii-1]=$('.optionnum'+ii).val();
    //                 choose_arr[ii-1]=result;
    //             }
    //             chooselist=choose_arr.join(',');
    //             optionwidth=optionwidtharr.join(',');
    //             optionnum=optionnumarr.join(',');
    //         }else{
    //             optionwidth=$('.optionwidth1').val();
    //             optionnum=$('.optionnum1').val();
    //         }
    //         var status='';
    //         if($('.status').length>0){
    //             $('.status').each(function(){
    //                 if($(this).attr('checked')=='checked'){
    //                     status = $(this).val();
    //                 }
    //             });
    //         }
    //         var remark=$('#Remark').val();

    //         var dfstyle='';
    //         if($('.DfStyle').length>0){
    //             $('.DfStyle').each(function(){
    //                 if($(this).attr('checked')=='checked'){
    //                     dfstyle = $(this).val();
    //                 }
    //             });
    //         }

    //         var diff=$('#Diff').val();
    //         //提交数据
    //         $.ajax({
    //             type: "POST",
    //             cache: false,
    //             url: U("Test/save"),
    //             data: "TestID="+testid+"&TypesID="+typesid+"&kl="+kl+"&cp="+cp+"&SpecialID="+specialid+"&DocID="+docid+"&Mark="+mark+"&Status="+status+"&Remark="+remark+"&DfStyle="+dfstyle+"&Diff="+diff+'&IfChoose='+choose+'&ChooseList='+chooselist+'&OptionWidth='+optionwidth+'&OptionNum='+optionnum,
    //             success: function(msg){
    //                 //权限验证
    //                 if(checkPower(msg)=='error'){
    //                     return false;
    //                 }
    //                 alert( "保存数据成功！" );
    //                 x=0;
    //                 $('#popup_container').remove();
    //                 $("#popup_overlay").remove();
    //             },
    //             error: function(XMLHttpRequest, textStatus, errorThrown){
    //                 x=0;
    //                 alert( "保存数据失败！请重试。" );
    //             }
    //         });
    //     }
    // });
});
</script>
{#// 加载尾部公共文件 #}
{#include file="Manage@Public/ends" /#}